'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _map2 = require('lodash/map');

var _map3 = _interopRequireDefault(_map2);

var _isEqual2 = require('lodash/isEqual');

var _isEqual3 = _interopRequireDefault(_isEqual2);

var _noop2 = require('lodash/noop');

var _noop3 = _interopRequireDefault(_noop2);

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('react-peek/prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _Icon = require('../Icon/Icon');

var _Icon2 = _interopRequireDefault(_Icon);

var _RadioButtonLabeled = require('../RadioButtonLabeled/RadioButtonLabeled');

var _RadioButtonLabeled2 = _interopRequireDefault(_RadioButtonLabeled);

var _CheckboxLabeled = require('../CheckboxLabeled/CheckboxLabeled');

var _CheckboxLabeled2 = _interopRequireDefault(_CheckboxLabeled);

var _styleHelpers = require('../../util/style-helpers.js');

var _componentTypes = require('../../util/component-types');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var cx = _styleHelpers.lucidClassNames.bind('&-IconSelect');

var arrayOf = _propTypes2.default.arrayOf,
    bool = _propTypes2.default.bool,
    func = _propTypes2.default.func,
    node = _propTypes2.default.node,
    number = _propTypes2.default.number,
    oneOf = _propTypes2.default.oneOf,
    string = _propTypes2.default.string,
    shape = _propTypes2.default.shape;


var getFigureParent = function getFigureParent(domNode) {
	if (domNode.classList.contains(cx('&-Item'))) {
		return domNode;
	}
	if (domNode === document.body) {
		throw new Error('domNode is not a child of .' + cx('&-Item'));
	}

	return getFigureParent(domNode.parentElement);
};
var IconSelect = (0, _componentTypes.createClass)({
	displayName: 'IconSelect',

	statics: {},

	propTypes: {
		className: string,

		children: node,

		items: arrayOf(shape({
			id: string.isRequired,
			icon: node,
			label: node,
			isSelected: bool,
			isPartial: bool,
			tabIndex: number,
			isDisabled: bool,
			className: string
		})).isRequired,

		kind: oneOf(['single', 'multiple']),

		onSelect: func,

		isDisabled: bool
	},

	getDefaultProps: function getDefaultProps() {
		return {
			kind: 'multiple',
			isDisabled: false,
			onSelect: _noop3.default
		};
	},
	handleClick: function handleClick(event) {
		if (!this.props.isDisabled) {
			var domNode = getFigureParent(event.target);
			var id = domNode.dataset.id;

			domNode.focus();
			if (!domNode.hasAttribute('disabled')) {
				this.props.onSelect(id, { event: event, props: this.props });
			}
		}
	},
	getChildIcon: function getChildIcon(icon) {
		return icon ? icon : _react2.default.createElement(
			_Icon2.default,
			null,
			_react2.default.createElement('rect', { x: '0', y: '0', width: '16', height: '16' }),
			_react2.default.createElement('rect', { x: '1', y: '1', width: '14', height: '14', fill: 'white' })
		);
	},
	getInputComponent: function getInputComponent(item) {
		var _props = this.props,
		    kind = _props.kind,
		    className = _props.className,
		    isDisabled = _props.isDisabled;

		var Label = item.label;
		var singleSelect = (0, _isEqual3.default)(kind, 'single');

		return singleSelect ? _react2.default.createElement(_RadioButtonLabeled2.default, {
			Label: Label,
			className: cx('&-Item-radio', _defineProperty({}, className + '-radio', className)),
			isDisabled: isDisabled || item.isDisabled,
			isSelected: item.isSelected,
			tabIndex: item.tabIndex
		}) : _react2.default.createElement(_CheckboxLabeled2.default, {
			Label: Label,
			className: cx('&-Item-checkbox', _defineProperty({}, className + '-checkbox', className)),
			isDisabled: isDisabled || item.isDisabled,
			isIndeterminate: item.isPartial,
			isSelected: item.isSelected,
			tabIndex: item.tabIndex
		});
	},
	render: function render() {
		var _this = this;

		var _props2 = this.props,
		    className = _props2.className,
		    children = _props2.children,
		    kind = _props2.kind,
		    items = _props2.items,
		    isDisabled = _props2.isDisabled,
		    passThroughs = _objectWithoutProperties(_props2, ['className', 'children', 'kind', 'items', 'isDisabled']);

		return _react2.default.createElement(
			'span',
			_extends({}, (0, _componentTypes.omitProps)(passThroughs, IconSelect, ['items']), {
				className: cx('&', className)
			}),
			(0, _map3.default)(items, function (childItem, index) {
				var _cx3;

				return _react2.default.createElement(
					'figure',
					{
						key: 'iconselectitem_' + index,
						className: cx('&-Item', childItem.className, (_cx3 = {}, _defineProperty(_cx3, className + '-Item', className), _defineProperty(_cx3, '&-Item-is-disabled', isDisabled || childItem.isDisabled), _defineProperty(_cx3, '&-Item-is-partial', childItem.isPartial), _defineProperty(_cx3, '&-Item-is-selected', childItem.isSelected), _defineProperty(_cx3, '&-Item-multi', kind === 'multiple'), _defineProperty(_cx3, '&-Item-single', kind === 'single'), _cx3)),
						'data-id': childItem.id,
						onClick: _this.handleClick,
						disabled: isDisabled || childItem.isDisabled
					},
					_this.getChildIcon(childItem.icon),
					_react2.default.createElement(
						'figcaption',
						{ className: cx('&-Item-figcaption') },
						_this.getInputComponent(childItem)
					)
				);
			}),
			children
		);
	}
});

exports.default = IconSelect;