{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _get2 = require('lodash/get');\n\nvar _get3 = _interopRequireDefault(_get2);\n\nvar _matches2 = require('lodash/matches');\n\nvar _matches3 = _interopRequireDefault(_matches2);\n\nvar _includes2 = require('lodash/includes');\n\nvar _includes3 = _interopRequireDefault(_includes2);\n\nvar _isUndefined2 = require('lodash/isUndefined');\n\nvar _isUndefined3 = _interopRequireDefault(_isUndefined2);\n\nvar _defer2 = require('lodash/defer');\n\nvar _defer3 = _interopRequireDefault(_defer2);\n\nvar _uniqueId2 = require('lodash/uniqueId');\n\nvar _uniqueId3 = _interopRequireDefault(_uniqueId2);\n\nvar _constant2 = require('lodash/constant');\n\nvar _constant3 = _interopRequireDefault(_constant2);\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('react-peek/prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _Portal = require('../Portal/Portal');\n\nvar _Portal2 = _interopRequireDefault(_Portal);\n\nvar _componentTypes = require('../../util/component-types');\n\nvar _domHelpers = require('../../util/dom-helpers');\n\nvar _styleHelpers = require('../../util/style-helpers');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n\nvar cx = _styleHelpers.lucidClassNames.bind('&-ContextMenu');\n\nvar bool = _propTypes2.default.bool,\n    node = _propTypes2.default.node,\n    func = _propTypes2.default.func,\n    number = _propTypes2.default.number,\n    object = _propTypes2.default.object,\n    oneOf = _propTypes2.default.oneOf,\n    string = _propTypes2.default.string;\nvar ContextMenu = (0, _componentTypes.createClass)({\n  displayName: 'ContextMenu',\n  statics: {\n    CENTER: 'center',\n    DOWN: 'down',\n    END: 'end',\n    LEFT: 'left',\n    RIGHT: 'right',\n    START: 'start',\n    UP: 'up'\n  },\n  propTypes: {\n    children: node,\n    className: string,\n    style: object,\n    direction: oneOf(['down', 'up', 'right', 'left']),\n    directonOffset: number,\n    alignment: oneOf(['start', 'center', 'end']),\n    alignmentOffset: number,\n    getAlignmentOffset: func,\n    minWidthOffset: number,\n    isExpanded: bool,\n    onClickOut: func,\n    portalId: string\n  },\n  components: {\n    Target: (0, _componentTypes.createClass)({\n      displayName: 'ContextMenu.Target',\n      statics: {},\n      propTypes: {\n        elementType: string\n      },\n      getDefaultProps: function getDefaultProps() {\n        return {\n          elementType: 'span'\n        };\n      }\n    }),\n    FlyOut: (0, _componentTypes.createClass)({\n      displayName: 'ContextMenu.FlyOut',\n      statics: {},\n      propTypes: {\n        style: object\n      }\n    })\n  },\n  getDefaultProps: function getDefaultProps() {\n    return {\n      direction: 'down',\n      directonOffset: 0,\n      minWidthOffset: 0,\n      alignment: 'start',\n      // no default alignmentOffset so it can default to result of `getAlignmentOffset`\n      getAlignmentOffset: (0, _constant3.default)(0),\n      isExpanded: true,\n      onClickOut: null,\n      portalId: null\n    };\n  },\n  getInitialState: function getInitialState() {\n    var portalId = this.props.portalId;\n    return {\n      portalId: portalId || (0, _uniqueId3.default)('ContextMenu-Portal-'),\n      targetRect: {\n        bottom: 0,\n        top: 0,\n        left: 0,\n        right: 0,\n        height: 0,\n        width: 0\n      },\n      flyOutHeight: 0,\n      flyOutWidth: 0\n    };\n  },\n  handleAlignment: function handleAlignment() {\n    if (this.continueAlignment) {\n      if (this.props.isExpanded) {\n        this.alignFlyOut(true);\n      }\n\n      window.requestAnimationFrame(this.handleAlignment);\n    }\n  },\n  beginAlignment: function beginAlignment() {\n    this.continueAlignment = true;\n    window.requestAnimationFrame(this.handleAlignment);\n  },\n  endAlignment: function endAlignment() {\n    this.continueAlignment = false;\n  },\n  componentDidMount: function componentDidMount() {\n    var _this = this;\n\n    (0, _defer3.default)(function () {\n      return _this.alignFlyOut();\n    });\n    this.beginAlignment();\n    document.body.addEventListener('touchstart', this.handleBodyClick);\n    document.body.addEventListener('click', this.handleBodyClick);\n  },\n  componentWillUnmount: function componentWillUnmount() {\n    this.endAlignment();\n    document.body.removeEventListener('click', this.handleBodyClick);\n  },\n  handleBodyClick: function handleBodyClick(event) {\n    var props = this.props,\n        onClickOut = this.props.onClickOut,\n        _refs = this.refs,\n        flyOutPortal = _refs.flyOutPortal,\n        target = _refs.target;\n\n    if (onClickOut && flyOutPortal) {\n      var flyOutEl = flyOutPortal.portalElement.firstChild;\n      var wasALabelClick = event.target.nodeName === 'INPUT' && (0, _domHelpers.sharesAncestor)(event.target, target, 'LABEL'); // Attempt to detect <label> click and ignore it\n\n      if (wasALabelClick) {\n        return;\n      }\n\n      if (!(flyOutEl.contains(event.target) || target.contains(event.target))) {\n        onClickOut({\n          props: props,\n          event: event\n        });\n      }\n    }\n  },\n  componentWillReceiveProps: function componentWillReceiveProps() {\n    var _this2 = this;\n\n    (0, _defer3.default)(function () {\n      return _this2.alignFlyOut();\n    });\n  },\n  getFlyoutPosition: function getFlyoutPosition() {\n    var _props = this.props,\n        alignment = _props.alignment,\n        getAlignmentOffset = _props.getAlignmentOffset,\n        direction = _props.direction,\n        directonOffset = _props.directonOffset,\n        _state = this.state,\n        flyOutHeight = _state.flyOutHeight,\n        flyOutWidth = _state.flyOutWidth,\n        _state$targetRect = _state.targetRect,\n        bottom = _state$targetRect.bottom,\n        left = _state$targetRect.left,\n        right = _state$targetRect.right,\n        top = _state$targetRect.top,\n        width = _state$targetRect.width,\n        height = _state$targetRect.height,\n        flyOutPortal = this.refs.flyOutPortal;\n\n    if (!flyOutPortal) {\n      return {};\n    }\n\n    var alignmentOffset = !(0, _isUndefined3.default)(this.props.alignmentOffset) ? this.props.alignmentOffset : alignment === ContextMenu.CENTER ? getAlignmentOffset((0, _includes3.default)([ContextMenu.UP, ContextMenu.DOWN], direction) ? flyOutWidth : flyOutHeight) : 0;\n    var CENTER = ContextMenu.CENTER,\n        DOWN = ContextMenu.DOWN,\n        END = ContextMenu.END,\n        LEFT = ContextMenu.LEFT,\n        RIGHT = ContextMenu.RIGHT,\n        START = ContextMenu.START,\n        UP = ContextMenu.UP;\n    var clientWidth = document.body.clientWidth; // default styling hides portal because its position can't be calculated\n    // properly until after 1st render so here we unhide it if the ref exists\n\n    var style = {\n      opacity: 1,\n      maxHeight: 'none',\n      left: 'auto',\n      top: 'auto'\n    };\n    var matcher = (0, _matches3.default)({\n      direction: direction,\n      alignment: alignment\n    });\n\n    if (matcher({\n      direction: UP,\n      alignment: START\n    })) {\n      return _extends({}, style, {\n        top: top - flyOutHeight - directonOffset,\n        left: left - alignmentOffset\n      });\n    }\n\n    if (matcher({\n      direction: UP,\n      alignment: END\n    })) {\n      return _extends({}, style, {\n        top: top - flyOutHeight - directonOffset,\n        right: clientWidth - right - alignmentOffset\n      });\n    }\n\n    if (matcher({\n      direction: UP,\n      alignment: CENTER\n    })) {\n      return _extends({}, style, {\n        top: top - flyOutHeight - directonOffset,\n        left: left + width / 2 - flyOutWidth / 2 + alignmentOffset\n      });\n    }\n\n    if (matcher({\n      direction: DOWN,\n      alignment: START\n    })) {\n      return _extends({}, style, {\n        top: bottom + directonOffset,\n        left: left - alignmentOffset\n      });\n    }\n\n    if (matcher({\n      direction: DOWN,\n      alignment: END\n    })) {\n      return _extends({}, style, {\n        top: bottom + directonOffset,\n        right: clientWidth - right - alignmentOffset\n      });\n    }\n\n    if (matcher({\n      direction: DOWN,\n      alignment: CENTER\n    })) {\n      return _extends({}, style, {\n        top: bottom + directonOffset,\n        left: left + width / 2 - flyOutWidth / 2 + alignmentOffset\n      });\n    }\n\n    if (matcher({\n      direction: LEFT,\n      alignment: START\n    })) {\n      return _extends({}, style, {\n        top: top - alignmentOffset,\n        right: clientWidth - left + directonOffset\n      });\n    }\n\n    if (matcher({\n      direction: LEFT,\n      alignment: END\n    })) {\n      return _extends({}, style, {\n        top: top - flyOutHeight + height + alignmentOffset,\n        right: clientWidth - left + directonOffset\n      });\n    }\n\n    if (matcher({\n      direction: LEFT,\n      alignment: CENTER\n    })) {\n      return _extends({}, style, {\n        top: top - flyOutHeight / 2 + height / 2 + alignmentOffset,\n        right: clientWidth - left + directonOffset\n      });\n    }\n\n    if (matcher({\n      direction: RIGHT,\n      alignment: START\n    })) {\n      return _extends({}, style, {\n        top: top - alignmentOffset,\n        left: left + width + directonOffset\n      });\n    }\n\n    if (matcher({\n      direction: RIGHT,\n      alignment: END\n    })) {\n      return _extends({}, style, {\n        top: top - flyOutHeight + height + alignmentOffset,\n        left: left + width + directonOffset\n      });\n    }\n\n    if (matcher({\n      direction: RIGHT,\n      alignment: CENTER\n    })) {\n      return _extends({}, style, {\n        top: top - flyOutHeight / 2 + height / 2 + alignmentOffset,\n        left: left + width + directonOffset\n      });\n    }\n  },\n  alignFlyOut: function alignFlyOut() {\n    var doRedunancyCheck = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    var _refs2 = this.refs,\n        flyOutPortal = _refs2.flyOutPortal,\n        target = _refs2.target;\n\n    if (!target || !flyOutPortal) {\n      return;\n    }\n\n    var targetRect = (0, _domHelpers.getAbsoluteBoundingClientRect)(target); // Don't cause a state-change if target dimensions are the same\n\n    if (doRedunancyCheck && targetRect.left === this.state.targetRect.left && targetRect.top === this.state.targetRect.top && targetRect.height === this.state.targetRect.height && targetRect.width === this.state.targetRect.width) {\n      return;\n    }\n\n    if (!flyOutPortal) {\n      return this.setState({\n        targetRect: targetRect\n      });\n    }\n\n    var flyOutEl = flyOutPortal.portalElement.firstChild;\n\n    var _flyOutEl$getBounding = flyOutEl.getBoundingClientRect(),\n        height = _flyOutEl$getBounding.height,\n        width = _flyOutEl$getBounding.width;\n\n    this.setState({\n      targetRect: targetRect,\n      flyOutHeight: height,\n      flyOutWidth: width\n    });\n  },\n  render: function render() {\n    var _props2 = this.props,\n        className = _props2.className,\n        direction = _props2.direction,\n        isExpanded = _props2.isExpanded,\n        style = _props2.style,\n        minWidthOffset = _props2.minWidthOffset,\n        passThroughs = _objectWithoutProperties(_props2, ['className', 'direction', 'isExpanded', 'style', 'minWidthOffset']),\n        _state2 = this.state,\n        portalId = _state2.portalId,\n        targetRect = _state2.targetRect;\n\n    var targetElement = (0, _componentTypes.getFirst)(this.props, ContextMenu.Target);\n    var targetChildren = (0, _get3.default)(targetElement, 'props.children', null);\n    var TargetElementType = targetElement.props.elementType;\n    var flyoutElement = (0, _componentTypes.getFirst)(this.props, ContextMenu.FlyOut);\n    var flyProps = (0, _get3.default)(flyoutElement, 'props', {});\n    return _react2.default.createElement(TargetElementType, _extends({\n      ref: 'target'\n    }, (0, _componentTypes.omitProps)(passThroughs, ContextMenu), {\n      className: cx('&', className),\n      style: style\n    }), targetChildren, isExpanded ? _react2.default.createElement(_Portal2.default, _extends({\n      ref: 'flyOutPortal'\n    }, flyProps, {\n      className: cx('&-FlyOut', '&-FlyOut-' + direction, flyProps.className),\n      portalId: portalId,\n      style: _extends({\n        minWidth: targetRect.width + minWidthOffset\n      }, this.getFlyoutPosition(), flyProps.style)\n    }), flyProps.children) : null);\n  }\n});\nexports.default = ContextMenu;","map":null,"metadata":{},"sourceType":"script"}